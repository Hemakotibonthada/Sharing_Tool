<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Circuvent Technologies</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .settings-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .settings-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-title h1 {
            font-size: 28px;
            color: #2d3748;
            font-weight: 700;
        }

        .breadcrumb {
            font-size: 14px;
            color: #718096;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        .settings-sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 20px;
            height: fit-content;
        }

        .sidebar-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4a5568;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .sidebar-item:hover {
            background: #f7fafc;
            color: #667eea;
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-item-icon {
            font-size: 18px;
        }

        .settings-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .section-title {
            font-size: 24px;
            color: #2d3748;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .section-description {
            font-size: 14px;
            color: #718096;
            margin-bottom: 30px;
        }

        .setting-group {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e2e8f0;
        }

        .setting-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .setting-label {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-hint {
            font-size: 13px;
            color: #718096;
            margin-bottom: 12px;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234a5568' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e0;
            transition: .3s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .setting-info {
            flex: 1;
            margin-right: 20px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-pro {
            background: #fbd38d;
            color: #744210;
        }

        .badge-beta {
            background: #bee3f8;
            color: #2c5282;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .alert-info {
            background: #e6f2ff;
            color: #2b6cb0;
            border: 1px solid #bee3f8;
        }

        .alert-warning {
            background: #fffaf0;
            color: #c05621;
            border: 1px solid #fbd38d;
        }

        .alert-success {
            background: #f0fff4;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .save-bar {
            position: fixed;
            bottom: -100px;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            transition: bottom 0.3s;
            z-index: 1000;
        }

        .save-bar.visible {
            bottom: 0;
        }

        .quota-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .quota-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 0.3s;
        }

        .quota-fill.warning {
            background: linear-gradient(90deg, #f6ad55 0%, #ed8936 100%);
        }

        .quota-fill.danger {
            background: linear-gradient(90deg, #fc8181 0%, #f56565 100%);
        }

        .quota-text {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #718096;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }

            .settings-sidebar {
                display: flex;
                overflow-x: auto;
                padding: 15px;
            }

            .sidebar-item {
                white-space: nowrap;
            }

            .input-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <!-- Header -->
        <div class="settings-header">
            <div class="settings-title">
                <h1>‚öôÔ∏è Settings</h1>
                <div class="breadcrumb">
                    <a href="/">Home</a> / <a href="/admin">Admin</a> / Settings
                </div>
            </div>
            <div class="nav-buttons">
                <a href="/admin" class="btn btn-secondary">‚Üê Back to Admin</a>
            </div>
        </div>

        <!-- Settings Grid -->
        <div class="settings-grid">
            <!-- Sidebar Navigation -->
            <div class="settings-sidebar">
                <div class="sidebar-item active" onclick="showSection('general', this)">
                    <span class="sidebar-item-icon">üåê</span>
                    <span>General</span>
                </div>
                <div class="sidebar-item" onclick="showSection('security', this)">
                    <span class="sidebar-item-icon">üîí</span>
                    <span>Security</span>
                </div>
                <div class="sidebar-item" onclick="showSection('storage', this)">
                    <span class="sidebar-item-icon">üíæ</span>
                    <span>Storage</span>
                </div>
                <div class="sidebar-item" onclick="showSection('transfer', this)">
                    <span class="sidebar-item-icon">‚ö°</span>
                    <span>Transfer</span>
                </div>
                <div class="sidebar-item" onclick="showSection('notifications', this)">
                    <span class="sidebar-item-icon">üîî</span>
                    <span>Notifications</span>
                </div>
                <div class="sidebar-item" onclick="showSection('advanced', this)">
                    <span class="sidebar-item-icon">üõ†Ô∏è</span>
                    <span>Advanced</span>
                </div>
            </div>

            <!-- Settings Content -->
            <div class="settings-content">
                <!-- General Settings -->
                <div id="general" class="settings-section active">
                    <h2 class="section-title">General Settings</h2>
                    <p class="section-description">Configure basic application settings and preferences</p>

                    <div class="setting-group">
                        <div class="setting-label">Application Name</div>
                        <div class="setting-hint">Customize the name displayed across the application</div>
                        <input type="text" class="form-control" value="Circuvent Technologies" id="appName">
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Server Port</div>
                        <div class="setting-hint">Port number for the web server (requires restart)</div>
                        <input type="number" class="form-control" value="5000" id="serverPort">
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Language & Region</div>
                        <div class="setting-hint">Set your preferred language and timezone</div>
                        <div class="input-group">
                            <select class="form-control form-select" id="language">
                                <option value="en">English</option>
                                <option value="es">Espa√±ol</option>
                                <option value="fr">Fran√ßais</option>
                                <option value="de">Deutsch</option>
                                <option value="zh">‰∏≠Êñá</option>
                            </select>
                            <select class="form-control form-select" id="timezone">
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern Time</option>
                                <option value="America/Chicago">Central Time</option>
                                <option value="America/Los_Angeles">Pacific Time</option>
                                <option value="Europe/London">London</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable QR Code</div>
                                <div class="setting-hint">Show QR code for easy mobile access</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableQR">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Dark Mode <span class="badge badge-beta">Beta</span></div>
                                <div class="setting-hint">Enable dark theme for better visibility at night</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkMode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div id="security" class="settings-section">
                    <h2 class="section-title">Security Settings</h2>
                    <p class="section-description">Manage authentication and access control settings</p>

                    <div class="alert alert-warning">
                        <span>‚ö†Ô∏è</span>
                        <span>Changing security settings may affect all connected users. Use with caution.</span>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable Authentication</div>
                                <div class="setting-hint">Require login for all users</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableAuth">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Session Timeout</div>
                        <div class="setting-hint">Automatic logout after inactivity (in days)</div>
                        <select class="form-control form-select" id="sessionTimeout">
                            <option value="1">1 day</option>
                            <option value="7" selected>7 days</option>
                            <option value="14">14 days</option>
                            <option value="30">30 days</option>
                            <option value="0">Never</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Password Requirements</div>
                        <div class="setting-hint">Minimum password strength for new accounts</div>
                        <select class="form-control form-select" id="passwordStrength">
                            <option value="weak">Weak (4+ characters)</option>
                            <option value="medium" selected>Medium (8+ characters)</option>
                            <option value="strong">Strong (12+ with special chars)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Two-Factor Authentication <span class="badge badge-pro">Pro</span></div>
                                <div class="setting-hint">Add extra layer of security with 2FA</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enable2FA" disabled>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">IP Whitelist</div>
                                <div class="setting-hint">Only allow connections from specific IPs</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableIPWhitelist">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Storage Settings -->
                <div id="storage" class="settings-section">
                    <h2 class="section-title">Storage Settings</h2>
                    <p class="section-description">Configure storage limits and file management</p>

                    <div class="setting-group">
                        <div class="setting-label">Storage Usage</div>
                        <div class="setting-hint">Current storage consumption</div>
                        <div class="quota-bar">
                            <div class="quota-fill" style="width: 45%"></div>
                        </div>
                        <div class="quota-text">
                            <span>4.5 GB used</span>
                            <span>10 GB total</span>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Maximum Storage Limit</div>
                        <div class="setting-hint">Total storage quota for all files (GB)</div>
                        <input type="number" class="form-control" value="1024" id="storageLimit" min="1" max="10240" step="1">
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Maximum File Size</div>
                        <div class="setting-hint">Maximum size for individual file uploads</div>
                        <select class="form-control form-select" id="maxFileSize">
                            <option value="10">10 MB</option>
                            <option value="50">50 MB</option>
                            <option value="100">100 MB</option>
                            <option value="500">500 MB</option>
                            <option value="1024">1 GB</option>
                            <option value="5120">5 GB</option>
                            <option value="10240">10 GB</option>
                            <option value="51200">50 GB</option>
                            <option value="102400">100 GB</option>
                            <option value="512000">500 GB</option>
                            <option value="1048576" selected>1 TB</option>
                            <option value="0">Unlimited</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Allowed File Types</div>
                        <div class="setting-hint">Comma-separated list of allowed extensions (e.g., jpg,pdf,zip). Leave empty for all types</div>
                        <input type="text" class="form-control" placeholder="All file types allowed" id="allowedTypes">
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Delete Old Files</div>
                                <div class="setting-hint">Automatically remove files older than 30 days</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoDelete">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable File Versioning</div>
                                <div class="setting-hint">Keep previous versions when files are updated</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableVersioning">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Transfer Settings -->
                <div id="transfer" class="settings-section">
                    <h2 class="section-title">Transfer Settings</h2>
                    <p class="section-description">Configure upload/download speed and performance</p>

                    <div class="alert alert-info">
                        <span>‚ÑπÔ∏è</span>
                        <span>WebSocket transfers are optimized for speeds up to 1 Gbps on supported networks.</span>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Transfer Protocol</div>
                        <div class="setting-hint">Choose the transfer method for file operations</div>
                        <select class="form-control form-select" id="transferProtocol">
                            <option value="websocket" selected>WebSocket (High Speed)</option>
                            <option value="http">HTTP (Standard)</option>
                            <option value="auto">Auto (Smart Selection)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Chunk Size</div>
                        <div class="setting-hint">Size of data chunks for transfer (MB)</div>
                        <select class="form-control form-select" id="chunkSize">
                            <option value="1">1 MB</option>
                            <option value="2">2 MB</option>
                            <option value="4" selected>4 MB (Recommended)</option>
                            <option value="8">8 MB</option>
                            <option value="16">16 MB</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Parallel Transfers</div>
                        <div class="setting-hint">Number of simultaneous chunk transfers</div>
                        <select class="form-control form-select" id="parallelTransfers">
                            <option value="2">2</option>
                            <option value="4">4</option>
                            <option value="8" selected>8 (Recommended)</option>
                            <option value="16">16</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Bandwidth Limit</div>
                        <div class="setting-hint">Maximum transfer speed (Mbps, 0 = unlimited)</div>
                        <input type="number" class="form-control" value="0" placeholder="Unlimited" id="bandwidthLimit">
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable Resume</div>
                                <div class="setting-hint">Allow resuming interrupted downloads</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableResume">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable Compression</div>
                                <div class="setting-hint">Compress files before transfer (slower but saves bandwidth)</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableCompression">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Notifications Settings -->
                <div id="notifications" class="settings-section">
                    <h2 class="section-title">Notification Settings</h2>
                    <p class="section-description">Manage notification preferences and alerts</p>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable Notifications</div>
                                <div class="setting-hint">Show system notifications for events</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableNotifications">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Upload Complete</div>
                                <div class="setting-hint">Notify when file uploads finish</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="notifyUpload">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Download Complete</div>
                                <div class="setting-hint">Notify when file downloads finish</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="notifyDownload">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">New User Registration</div>
                                <div class="setting-hint">Notify admins when new users register</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="notifyNewUser">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Delete Requests</div>
                                <div class="setting-hint">Notify when users request file deletions</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="notifyDelete">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Email Notifications <span class="badge badge-pro">Pro</span></div>
                        <div class="setting-hint">Send email alerts to administrators</div>
                        <input type="email" class="form-control" placeholder="admin@example.com" id="adminEmail" disabled>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div id="advanced" class="settings-section">
                    <h2 class="section-title">Advanced Settings</h2>
                    <p class="section-description">Expert configuration options and system management</p>

                    <div class="alert alert-warning">
                        <span>‚ö†Ô∏è</span>
                        <span>Advanced settings should only be modified by experienced users. Incorrect values may affect system stability.</span>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Debug Mode</div>
                                <div class="setting-hint">Enable detailed logging for troubleshooting</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="debugMode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable CORS</div>
                                <div class="setting-hint">Allow cross-origin resource sharing</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableCORS">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">CORS Allowed Origins</div>
                        <div class="setting-hint">Comma-separated list of allowed origins (* for all)</div>
                        <input type="text" class="form-control" value="*" id="corsOrigins">
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-info">
                                <div class="setting-label">Enable HTTPS <span class="badge badge-pro">Pro</span></div>
                                <div class="setting-hint">Use SSL/TLS for encrypted connections</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableHTTPS" disabled>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Database Cleanup</div>
                        <div class="setting-hint">Optimize database and remove old records</div>
                        <button class="btn btn-secondary" onclick="cleanupDatabase()">
                            üóëÔ∏è Run Cleanup
                        </button>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Export Settings</div>
                        <div class="setting-hint">Download current configuration as JSON</div>
                        <button class="btn btn-secondary" onclick="exportSettings()">
                            üì• Export Configuration
                        </button>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">Reset to Defaults</div>
                        <div class="setting-hint">Restore all settings to factory defaults</div>
                        <button class="btn btn-secondary" onclick="resetSettings()" style="background: #feb2b2; color: #742a2a;">
                            ‚ö†Ô∏è Reset All Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Bar -->
    <div class="save-bar" id="saveBar">
        <button class="btn btn-secondary" onclick="discardChanges()">Discard Changes</button>
        <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Changes</button>
    </div>

    <script>
        let hasChanges = false;

        // Show section
        function showSection(sectionId, element) {
            // Update sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            } else {
                // Find and activate the clicked element
                const clickedItem = document.querySelector(`[onclick*="${sectionId}"]`);
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            }

            // Update content
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Track changes
        document.querySelectorAll('input, select, textarea').forEach(element => {
            element.addEventListener('change', () => {
                hasChanges = true;
                document.getElementById('saveBar').classList.add('visible');
            });
        });

        // Save settings
        async function saveSettings() {
            const settings = {
                general: {
                    appName: document.getElementById('appName').value,
                    serverPort: document.getElementById('serverPort').value,
                    language: document.getElementById('language').value,
                    timezone: document.getElementById('timezone').value,
                    enableQR: document.getElementById('enableQR').checked,
                    darkMode: document.getElementById('darkMode').checked
                },
                security: {
                    enableAuth: document.getElementById('enableAuth').checked,
                    sessionTimeout: document.getElementById('sessionTimeout').value,
                    passwordStrength: document.getElementById('passwordStrength').value,
                    enable2FA: document.getElementById('enable2FA').checked,
                    enableIPWhitelist: document.getElementById('enableIPWhitelist').checked
                },
                storage: {
                    storageLimit: document.getElementById('storageLimit').value,
                    maxFileSize: document.getElementById('maxFileSize').value,
                    allowedTypes: document.getElementById('allowedTypes').value,
                    autoDelete: document.getElementById('autoDelete').checked,
                    enableVersioning: document.getElementById('enableVersioning').checked
                },
                transfer: {
                    transferProtocol: document.getElementById('transferProtocol').value,
                    chunkSize: document.getElementById('chunkSize').value,
                    parallelTransfers: document.getElementById('parallelTransfers').value,
                    bandwidthLimit: document.getElementById('bandwidthLimit').value,
                    enableResume: document.getElementById('enableResume').checked,
                    enableCompression: document.getElementById('enableCompression').checked
                },
                notifications: {
                    enableNotifications: document.getElementById('enableNotifications').checked,
                    notifyUpload: document.getElementById('notifyUpload').checked,
                    notifyDownload: document.getElementById('notifyDownload').checked,
                    notifyNewUser: document.getElementById('notifyNewUser').checked,
                    notifyDelete: document.getElementById('notifyDelete').checked,
                    adminEmail: document.getElementById('adminEmail').value
                },
                advanced: {
                    debugMode: document.getElementById('debugMode').checked,
                    enableCORS: document.getElementById('enableCORS').checked,
                    corsOrigins: document.getElementById('corsOrigins').value,
                    enableHTTPS: document.getElementById('enableHTTPS').checked
                }
            };

            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    showAlert('Settings saved successfully!', 'success');
                    hasChanges = false;
                    document.getElementById('saveBar').classList.remove('visible');
                } else {
                    showAlert('Failed to save settings', 'error');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showAlert('Error saving settings', 'error');
            }
        }

        // Discard changes
        function discardChanges() {
            if (confirm('Are you sure you want to discard all changes?')) {
                location.reload();
            }
        }

        // Cleanup database
        function cleanupDatabase() {
            if (confirm('This will remove old records and optimize the database. Continue?')) {
                showAlert('Database cleanup started...', 'info');
                // Implementation here
            }
        }

        // Export settings
        function exportSettings() {
            const settings = {
                // Collect all settings
                exported: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'settings-export.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Reset settings
        function resetSettings() {
            if (confirm('This will reset ALL settings to factory defaults. This action cannot be undone. Continue?')) {
                if (confirm('Are you absolutely sure? All custom configurations will be lost.')) {
                    showAlert('Settings reset to defaults', 'success');
                    setTimeout(() => location.reload(), 2000);
                }
            }
        }

        // Show alert
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 3000);
        }

        // Load settings on page load
        async function loadSettings() {
            try {
                console.log('Loading settings...');
                const token = localStorage.getItem('authToken');
                console.log('Token:', token ? 'Found' : 'Not found');
                
                const response = await fetch('/api/admin/settings', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('Settings response status:', response.status);

                if (response.ok) {
                    const settings = await response.json();
                    console.log('Settings loaded:', settings);
                    // Populate form fields with loaded settings
                    if (settings.general) {
                        Object.keys(settings.general).forEach(key => {
                            const element = document.getElementById(key);
                            if (element) {
                                if (element.type === 'checkbox') {
                                    element.checked = settings.general[key];
                                } else {
                                    element.value = settings.general[key];
                                }
                            }
                        });
                    }
                    showAlert('Settings loaded successfully', 'success');
                } else {
                    console.error('Failed to load settings:', response.status);
                    showAlert('Failed to load settings', 'error');
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showAlert('Error loading settings: ' + error.message, 'error');
            }
        }

        // Warn before leaving with unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (hasChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Check authentication on page load
        async function checkAuth() {
            console.log('Checking authentication...');
            const token = localStorage.getItem('authToken');
            if (!token) {
                console.warn('No auth token found, redirecting to login');
                window.location.href = '/login';
                return false;
            }
            console.log('Auth token found, syncing to cookie');
            // Sync token to cookie for server-side validation
            document.cookie = `authToken=${token}; path=/; max-age=604800`;
            return true;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Settings page loaded');
            const isAuthenticated = await checkAuth();
            if (isAuthenticated) {
                console.log('User authenticated, loading settings');
                loadSettings();
                
                // Initialize first section as active
                showSection('general', document.querySelector('.sidebar-item'));
            } else {
                console.error('User not authenticated');
            }
        });
    </script>
</body>
</html>
